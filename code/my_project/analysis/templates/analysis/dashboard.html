{% load static %}
<!DOCTYPE html>
<html lang="en"> <!--begin::Head-->

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>MDVP | Dashboard </title><!--begin::Primary Meta Tags-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="title" content="MDVP | Dashboard">
    <meta name="author" content="ColorlibHQ">
    <meta name="description" content="AdminLTE is a Free Bootstrap 5 Admin Dashboard, 30 example pages using Vanilla JS.">
    <meta name="keywords" content="bootstrap 5, bootstrap, bootstrap 5 admin dashboard, bootstrap 5 dashboard, bootstrap 5 charts, bootstrap 5 calendar, bootstrap 5 datepicker, bootstrap 5 tables, bootstrap 5 datatable, vanilla js datatable, colorlibhq, colorlibhq dashboard, colorlibhq admin dashboard"><!--end::Primary Meta Tags--><!--begin::Fonts-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/source-sans-3@5.0.12/index.css" integrity="sha256-tXJfXfp6Ewt1ilPzLDtQnJV4hclT9XuaZUKyUvmyr+Q=" crossorigin="anonymous"><!--end::Fonts--><!--begin::Third Party Plugin(OverlayScrollbars)-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.3.0/styles/overlayscrollbars.min.css" integrity="sha256-dSokZseQNT08wYEWiz5iLI8QPlKxG+TswNRD8k35cpg=" crossorigin="anonymous"><!--end::Third Party Plugin(OverlayScrollbars)--><!--begin::Third Party Plugin(Bootstrap Icons)-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.min.css" integrity="sha256-Qsx5lrStHZyR9REqhUF8iQt73X06c8LGIUPzpOhwRrI=" crossorigin="anonymous"><!--end::Third Party Plugin(Bootstrap Icons)--><!--begin::Required Plugin(AdminLTE)-->
    <link rel="stylesheet" href="{% static 'analysis/css/adminlte.css' %}"><!--end::Required Plugin(AdminLTE)--><!-- apexcharts -->
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&display=swap" rel="stylesheet"><!-- custom font -->
    <link rel="icon" href="{% static 'analysis/favicon.png' %}" type="image/png">

    <!-- Include ECharts library -->
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <style> 
        .platform-title {
            font-size: 36px;
            font-weight: bold;
            color: #d9695a;
            text-align: center;
        }
    </style>
</head>

<body class="layout-fixed sidebar-expand-lg bg-body-tertiary"> <!--begin::App Wrapper-->
    <div class="app-wrapper"> <!--begin::Header-->
        <nav class="app-header navbar navbar-expand bg-body"> <!--begin::Container-->
            <div class="container-fluid"> <!--begin::Start Navbar Links-->
                <ul class="navbar-nav">
                    <li class="nav-item"> <a class="nav-link" data-lte-toggle="sidebar" href="#" role="button"> <i class="bi bi-list"></i> </a> </li>
                    <li class="nav-item d-none d-md-block"> <a href="#" class="nav-link">Home</a> </li>
                    <li class="nav-item d-none d-md-block"> <a href="#" class="nav-link">Contact</a> </li>
                </ul> <!--end::Start Navbar Links--> <!--begin::End Navbar Links-->
                <ul class="navbar-nav ms-auto"> <!--begin::Navbar Search-->
                    <!--begin::Fullscreen Toggle-->
                    <li class="nav-item"> <a class="nav-link" href="#" data-lte-toggle="fullscreen"> <i data-lte-icon="maximize" class="bi bi-arrows-fullscreen"></i> <i data-lte-icon="minimize" class="bi bi-fullscreen-exit" style="display: none;"></i> </a> </li> <!--end::Fullscreen Toggle-->
                    <!--begin::Color code dropdown menu-->
                    <li class="nav-item dropdown">
                        <button
                          class="btn btn-link nav-link py-2 px-0 px-lg-2 dropdown-toggle d-flex align-items-center"
                          id="bd-theme"
                          type="button"
                          aria-expanded="false"
                          data-bs-toggle="dropdown"
                          data-bs-display="static"
                        >
                          <span class="theme-icon-active">
                            <i class="my-1"></i>
                          </span>
                          <span class="d-lg-none ms-2" id="bd-theme-text">Toggle theme</span>
                        </button>
                        <ul
                          class="dropdown-menu dropdown-menu-end"
                          aria-labelledby="bd-theme-text"
                          style="--bs-dropdown-min-width: 8rem;"
                        >
                          <li>
                            <button
                              type="button"
                              class="dropdown-item d-flex align-items-center active"
                              data-bs-theme-value="light"
                              aria-pressed="false"
                            >
                              <i class="bi bi-sun-fill me-2"></i>
                              Light
                              <i class="bi bi-check-lg ms-auto d-none"></i>
                            </button>
                          </li>
                          <li>
                            <button
                              type="button"
                              class="dropdown-item d-flex align-items-center"
                              data-bs-theme-value="dark"
                              aria-pressed="false"
                            >
                              <i class="bi bi-moon-fill me-2"></i>
                              Dark
                              <i class="bi bi-check-lg ms-auto d-none"></i>
                            </button>
                          </li>
                          <li>
                            <button
                              type="button"
                              class="dropdown-item d-flex align-items-center"
                              data-bs-theme-value="auto"
                              aria-pressed="true"
                            >
                              <i class="bi bi-circle-fill-half-stroke me-2"></i>
                              Auto
                              <i class="bi bi-check-lg ms-auto d-none"></i>
                            </button>
                          </li>
                        </ul>
                      </li><!--end::Color Code Dropdown-->
                    
                    <!--begin::User Menu Dropdown-->
                    <li class="nav-item dropdown user-menu"> <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"> <img src="{% static 'analysis/assets/img/user2-160x160.jpg' %}" class="user-image rounded-circle shadow" alt="User Image"> <span class="d-none d-md-inline">Alexander Pierce</span> </a>
                        <ul class="dropdown-menu dropdown-menu-lg dropdown-menu-end"> <!--begin::User Image-->
                            <li class="user-header text-bg-primary"> <img src="{% static 'analysis/assets/img/user2-160x160.jpg' %}" class="rounded-circle shadow" alt="User Image">
                                <p>
                                    Alexander Pierce - Web Developer
                                    <small>Member since Nov. 2023</small>
                                </p>
                            </li> <!--end::User Image--> <!--begin::Menu Body-->
                            <li class="user-body"> <!--begin::Row-->
                                <div class="row">
                                    <div class="col-4 text-center"> <a href="#"></a> </div>
                                    <div class="col-4 text-center"> <a href="#"></a> </div>
                                    <div class="col-4 text-center"> <a href="#"></a> </div>
                                </div> <!--end::Row-->
                            </li> <!--end::Menu Body--> <!--begin::Menu Footer-->
                            <li class="user-footer"> <a href="#" class="btn btn-default btn-flat">Profile</a> <a href="#" class="btn btn-default btn-flat float-end">Sign out</a> </li> <!--end::Menu Footer-->
                        </ul>
                    </li> <!--end::User Menu Dropdown-->
                </ul> <!--end::End Navbar Links-->
            </div> <!--end::Container-->
        </nav> <!--end::Header--> <!--begin::Sidebar-->
        <aside class="app-sidebar bg-body-secondary shadow" data-bs-theme="dark"> <!--begin::Sidebar Brand-->
            <div class="sidebar-brand"> <!--begin::Brand Link--> <a href="{% url 'analysis:index' %}" class="brand-link"> <!--begin::Brand Image--> <img src="{% static 'analysis/assets/img/mdvpLogo.png' %}" alt="MDVP Logo" class="brand-image opacity-75 shadow"> <!--end::Brand Image--> <!--begin::Brand Text--> <span class="brand-text fw-light">TEAM 3</span> <!--end::Brand Text--> </a> <!--end::Brand Link--> </div> <!--end::Sidebar Brand--> <!--begin::Sidebar Wrapper-->
            <div class="sidebar-wrapper">
                <nav class="mt-2"> <!--begin::Sidebar Menu-->
                    <ul class="nav sidebar-menu flex-column" data-lte-toggle="treeview" role="menu" data-accordion="false">
                        <li class="nav-item"> 
                            <a href="{% url 'analysis:dashboard' %}" class="nav-link active"> <!-- Direct link to dashboard.html -->
                                <i class="nav-icon bi bi-speedometer"></i>
                                <p>
                                    DASHBOARD
                                </p>
                            </a>
                           
                        </li>
                        <li class="nav-item"> <a href="#" class="nav-link"> <i class="nav-icon bi bi-box-seam-fill"></i>
                                <p>
                                    DATA ANALYSIS
                                    <i class="nav-arrow bi bi-chevron-right"></i>
                                </p>
                            </a>
                            <ul class="nav nav-treeview">
                                <li class="nav-item"> <div href="./widgets/small-box.html" class="nav-link"> <i class="nav-icon bi bi-circle" style="font-size: 0.5rem;"></i>
                                        <p>Box Office</p>
                                </div> </li>
                                <li class="nav-item"> <div href="./widgets/info-box.html" class="nav-link"> <i class="nav-icon bi bi-circle" style="font-size: 0.5rem;"></i>
                                        <p>Genre Insights</p>
                                </div> </li>
                                <li class="nav-item">
                                  <div href="./widgets/info-box.html" class="nav-link">
                                      <i class="nav-icon bi bi-circle" style="font-size: 0.5rem;"></i>
                                      <p>Movie Runtime</p>
                                  </div>
                              </li>
                                <li class="nav-item"> <div href="./widgets/cards.html" class="nav-link"> <i class="nav-icon bi bi-circle" style="font-size: 0.5rem;"></i>
                                        <p>Language Diversity</p>
                                </div> </li>    
                            </ul>
                        </li>
                        <li class="nav-item"> <a href="#" class="nav-link"> <i class="nav-icon bi bi-tree-fill"></i>
                                <p>
                                    SENTIMENT ANALYSIS
                                    <i class="nav-arrow bi bi-chevron-right"></i>
                                </p>
                            </a>
                            <ul class="nav nav-treeview">
                                <li class="nav-item"> <div href="./UI/general.html" class="nav-link"> <i class="nav-icon bi bi-circle" style="font-size: 0.5rem;"></i>
                                        <p>Word Cloud</p>
                                </div> </li>
                                <li class="nav-item"> <div href="./UI/icons.html" class="nav-link"> <i class="nav-icon bi bi-circle" style="font-size: 0.5rem;"></i>
                                        <p>Reviews Analysis</p>
                                </div> </li>                              
                            </ul>
                        </li>
                        <li class="nav-item"> <a href="#" class="nav-link"> <i class="nav-icon bi bi-pencil-square"></i>
                                <p>
                                    AI INSIGHTS
                                    <i class="nav-arrow bi bi-chevron-right"></i>
                                </p>
                            </a>
                            <ul class="nav nav-treeview">
                                <li class="nav-item"> <div href="./forms/general.html" class="nav-link"> <i class="nav-icon bi bi-circle" style="font-size: 0.5rem;"></i>
                                        <p>Trend Analysis</p>
                                </div> </li>
                                <li class="nav-item"> <div href="./forms/general.html" class="nav-link"> <i class="nav-icon bi bi-circle" style="font-size: 0.5rem;"></i>
                                        <p>AI Reports</p>
                                </div> </li>
                            </ul>
                        </li>
                    </ul> <!--end::Sidebar Menu-->
                </nav>
            </div> <!--end::Sidebar Wrapper-->
        </aside> <!--end::Sidebar--> <!--begin::App Main-->
        <main class="app-main"> <!--begin::App Content Header-->
          <div class="app-content"> <!-- Begin::Container -->
            <div class="container-fluid">
                <!-- First Row -->
                <div class="row">
                    <div class="col-lg-7">
                        <div class="card mb-4">
                            <div class="card-header border-0">
                                <div class="d-flex ">
                                    <h3 class="card-title custom-title">Distributions of Movie Releases by Year Intervals</h3>
                                    <!-- <a href="javascript:void(0);" class="link-primary link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover">View Report</a> -->
                                </div>
                            </div>
                            <div class="card-body">
                                <div id="movie-by-intervals-chart" style="min-height: 250px; height: 400px; width: 100%;"></div>
                            </div>
                        </div> <!-- /.card -->
                    </div> <!-- /.col-lg-7 -->
        
                    <div class="col-lg-5">
                        <div class="card mb-4">
                            <div class="card-header border-0">
                              <div class="d-flex ">
                                <h3 class="card-title custom-title">Top Movie Production Companies</h3>
                              </div>
                            </div>
                            <!-- Dropdown overlay inside the chart area -->
                            <div class="filter-overlay position-absolute d-flex" style="top: 50px; right: 10px; z-index: 10;">
                              <label for="ranking-filter" class="me-2"></label>
                              <select id="ranking-filter" class="form-select form-select-sm" style="width: auto;">
                                  <option value="5">Top 5</option>
                                  <option value="10"selected>Top 10</option>
                                  <option value="15">Top 15</option>
                                  <option value="20">Top 20</option>
                              </select>
                            </div>
                            <div class="card-body">
                              <div id="top-production-companies-chart" style="min-height: 250px; height: 400px; width: 100%;"></div>
                            </div>
                        </div> <!-- /.card -->
                    </div> <!-- /.col-lg-5 -->
                </div> <!-- /.first row -->
        
                <!-- Second Row for Award VS Rating bubble chart -->
                <div class="row">
                    <div class="col-lg-12">
                        <div class="card mb-4">
                            <div class="card-header border-0">
                              <div class="d-flex ">
                                <h3 class="card-title custom-title">Ratings VS Awards</h3>
                              </div> 
                                <div class="card-tools">
                                    <a href="#" class="btn btn-tool btn-sm">
                                        <i class="bi bi-download"></i>
                                    </a>
                                    <a href="#" class="btn btn-tool btn-sm">
                                        <i class="bi bi-list"></i>
                                    </a>
                                </div>
                            </div>
                            <div class="card-body table-responsive p-0">
                                <!-- Contents for Award VS Rating bubble chart here -->
                              <div id="award-bubble-chart" style="min-height: 250px; height: 400px; width: 100%;"></div>
                            </div>
                        </div> <!-- /.card -->

                    </div> <!-- /.col-lg-12 -->
                </div> <!-- /.second row -->
                <!-- Third Row for Rating distribution chart -->
                <div class="row">
                  <div class="col-lg-5"><!-- /.col-lg-5 -->
                    <div class="card mb-4">
                        <div class="card-header border-0">
                          <div class="d-flex">
                            <h3 class="card-title custom-title">Movie Production by Country</h3>
                          </div>
                        </div>
                        <div class="card-body">
                          <div id="movies-produced-funnel" style="min-height: 250px; height: 600px; width: 100%;"></div>
                        </div>
                    </div> <!-- /.card -->
                </div> <!-- /.col-lg-5 -->
                  <div class="col-lg-7">
                      <div class="card mb-4">
                          <div class="card-header border-0">
                            <div class="d-flex">
                              <h3 class="card-title custom-title">Ratings Distribution</h3>
                            </div>
                              <div class="card-tools">
                                  <a href="#" class="btn btn-tool btn-sm">
                                      <i class="bi bi-download"></i>
                                  </a>
                                  <a href="#" class="btn btn-tool btn-sm">
                                      <i class="bi bi-list"></i>
                                  </a>
                              </div>
                          </div>
                          <div class="card-body table-responsive p-0">
                              <!-- Contents for rating distribution chart here -->
                            <div id="rating-distribution-chart" style="min-height: 250px; height: 600px; width: 100%;"></div>
                          </div>
                      </div> <!-- /.card -->
                  </div> <!-- /.col-lg-7 -->
                  
                 <!-- Movies List Table (AJAX-enabled) -->
                  <div class="row">
                    <div class="col-12">
                      <div class="card mb-4">
                        <div class="card-header">
                          <div class="d-flex">
                          <h3 class="card-title custom-title">List of Movies</h3>
                          </div>
                          <div class="card-tools">
                            <ul class="pagination pagination-sm float-end">
                              <div class="pagination-container">
                                {% include "analysis/partials/pagination.html" %}
                              </div>
                            </ul>
                          </div>                                  
                        </div> <!-- /.card-header -->

                        <!-- Table structure with the container for AJAX -->
                        <div class="card-body p-0">
                          <table class="table table-striped">
                            <thead>
                              <tr>
                                <th>Image Preview</th>
                                <th>Title</th>
                                <th>Year</th>
                                <th>Ontime</th>
                                <th>Score</th>
                              </tr>
                            </thead>
                            <tbody id="movie-table-container">
                              {% include 'analysis/partials/movie_table.html' %}
                            </tbody>
                          </table>
                        </div> <!-- /.card-body -->
                      </div> <!-- /.card -->
                    </div> <!-- /.col-12 -->
                  </div> <!-- /.row --> 

                
              
            </div> <!-- /.container-fluid -->
        </div> <!-- /.app-content -->
        

        </main> <!--end::App Main--> <!--begin::Footer-->
        <footer class="app-footer"> <!--begin::To the end-->
            <div class="float-end d-none d-sm-inline">Anything you want</div> <!--end::To the end--> <!--begin::Copyright--> <strong>
                Copyright &copy; 2014-2024&nbsp;
                <a href="https://adminlte.io" class="text-decoration-none"></a>.
            </strong>
            All rights reserved.
            <!--end::Copyright-->
        </footer> <!--end::Footer-->
    </div> <!--end::App Wrapper--> <!--begin::Script--> <!--begin::Third Party Plugin(OverlayScrollbars)-->
    <script src="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.3.0/browser/overlayscrollbars.browser.es6.min.js" integrity="sha256-H2VM7BKda+v2Z4+DRy69uknwxjyDRhszjXFhsL4gD3w=" crossorigin="anonymous"></script> <!--end::Third Party Plugin(OverlayScrollbars)--><!--begin::Required Plugin(popperjs for Bootstrap 5)-->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha256-whL0tQWoY1Ku1iskqPFvmZ+CHsvmRWx/PIoEvIeWh4I=" crossorigin="anonymous"></script> <!--end::Required Plugin(popperjs for Bootstrap 5)--><!--begin::Required Plugin(Bootstrap 5)-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha256-YMa+wAM6QkVyz999odX7lPRxkoYAan8suedu4k2Zur8=" crossorigin="anonymous"></script> <!--end::Required Plugin(Bootstrap 5)--><!--begin::Required Plugin(AdminLTE)-->
    <script src="{% static 'analysis/js/adminlte.js' %}"></script> <!--end::Required Plugin(AdminLTE)--><!--begin::OverlayScrollbars Configure-->
    <script>
        const SELECTOR_SIDEBAR_WRAPPER = ".sidebar-wrapper";
        const Default = {
            scrollbarTheme: "os-theme-light",
            scrollbarAutoHide: "leave",
            scrollbarClickScroll: true,
        };
        document.addEventListener("DOMContentLoaded", function() {
            const sidebarWrapper = document.querySelector(SELECTOR_SIDEBAR_WRAPPER);
            if (
                sidebarWrapper &&
                typeof OverlayScrollbarsGlobal?.OverlayScrollbars !== "undefined"
            ) {
                OverlayScrollbarsGlobal.OverlayScrollbars(sidebarWrapper, {
                    scrollbars: {
                        theme: Default.scrollbarTheme,
                        autoHide: Default.scrollbarAutoHide,
                        clickScroll: Default.scrollbarClickScroll,
                    },
                });
            }
        });
    </script> <!--end::OverlayScrollbars Configure--> <!-- OPTIONAL SCRIPTS --> <!-- apexcharts -->
    
    <script>
        

        
    </script> <!--end::Script-->


<!-- Insert the Echart script here-->

<!-- ECharts Library from CDN -->
<script src="https://fastly.jsdelivr.net/npm/echarts@5.5.1/dist/echarts.min.js"></script>
<script type="text/javascript">
  // Define `topProductionCompaniesChart` as a global variable
  let topProductionCompaniesChart;

  document.addEventListener("DOMContentLoaded", function() {
    console.log("DOM fully loaded and parsed.");

    // Initialize the global chart instance
    topProductionCompaniesChart = echarts.init(document.getElementById('top-production-companies-chart'));
    console.log("topProductionCompaniesChart initialized:", topProductionCompaniesChart);

    // Parse chart data from Django context
    const movieIntervalsData = JSON.parse('{{ movie_distribution_by_year_intervals|safe|escapejs }}');
    const topCompaniesData = JSON.parse('{{ top_companies|safe|escapejs }}');
    const awardBubbleData = JSON.parse('{{ award_bubble_data|safe|escapejs }}');
    const ratingDistributionData = JSON.parse('{{ rating_distribution|safe|escapejs }}'); 
    const funnelData = JSON.parse('{{ funnel_data|safe|escapejs }}'); 

    // Initialize charts
    initChartWithTheme('movie-by-intervals-chart', movieIntervalsData, 'pie');
    initChartWithTheme('top-production-companies-chart', topCompaniesData, 'bar');
    initChartWithTheme('award-bubble-chart', awardBubbleData, 'bubble');
    initChartWithTheme('rating-distribution-chart', ratingDistributionData, 'nested_pie'); 
    //initChartWithTheme('movies-produced-funnel', funnelData, 'funnel');
    initMovieProductionChart('movies-produced-funnel', funnelData);  // Initialize the Movie Production chart

    
    function updateTopProductionCompaniesChart(data) {
    console.log("Data received for updateTopProductionCompaniesChart:", data);
    
    //topProductionCompaniesChart.clear();
    console.log("Chart cleared successfully.");

    // Define options with the new max
    const options = {
        title: {
            text: `Top ${data.length}`,
            left: 'center',
            top: '5%',
            textStyle: { color: '#fff' }
        },
        yAxis: {
            type: 'category',
            data: data.map(company => company.name),
            inverse: true,
        },
        xAxis: {
            type: 'value',
        },
        visualMap: {
            min: Math.min(...data.map(item => item.value)),
            max: Math.max(...data.map(item => item.value)), // Set min and max dynamically
            orient: 'horizontal',
            left: 'center',
            text: ['High Score', 'Low Score'],
            dimension: 0,
            inRange: { color: ['#65B581', '#FFCE34', '#FD665F'] }, // Adjusted color range
          },
        series: [{
            type: 'bar',
            data: data.map(company => company.value),
        }]
    };
    // Set options with the new max and series data
    topProductionCompaniesChart.setOption(options);
    //console.log("Chart updated with new options:", options);
}


    // Event listener to update the chart when the dropdown changes
    const filterElement = document.getElementById("ranking-filter");
    if (filterElement) {
      console.log("Ranking filter found. Adding change event listener.");
      filterElement.addEventListener("change", function() {
        const topN = parseInt(this.value);
        console.log(`Updating chart to show top ${topN} production companies`);

        // AJAX request to fetch new data
        fetch(`/analysis/dashboard/get-top-production-companies/?topN=${topN}`, {
          headers: { "X-Requested-With": "XMLHttpRequest" }
        })
        .then(response => response.json())
        .then(data => {
          console.log("Data fetched successfully:", data);
          updateTopProductionCompaniesChart(data.data);
        })
        .catch(error => console.error("Error fetching data:", error));
      });
    } else {
      console.error("Ranking filter element not found.");
    }
  });
</script>
<!-- Link to charts-setup.js, movieProductionChart.js -->
<script src="{% static 'analysis/js/charts-setup.js' %}"></script>
<script type="module" src="{% static 'analysis/js/movieProductionChart.js' %}"></script>

<!-- Insert the Color Mode Toggler script here -->
<script>    
// Color Mode Toggler
(() => {
  "use strict";

  const storedTheme = localStorage.getItem("theme");

  const getPreferredTheme = () => {
    if (storedTheme) {
      return storedTheme;
    }

    return window.matchMedia("(prefers-color-scheme: dark)").matches
      ? "dark"
      : "light";
  };

  const setTheme = function (theme) {
    if (
      theme === "auto" &&
      window.matchMedia("(prefers-color-scheme: dark)").matches
    ) {
      document.documentElement.setAttribute("data-bs-theme", "dark");
    } else {
      document.documentElement.setAttribute("data-bs-theme", theme);
    }
  };

  setTheme(getPreferredTheme());

    const showActiveTheme = (theme, focus = false) => {
    const themeSwitcher = document.querySelector("#bd-theme");

    if (!themeSwitcher) {
      return;
    }

    const themeSwitcherText = document.querySelector("#bd-theme-text");
    const activeThemeIcon = document.querySelector(".theme-icon-active i");
    const btnToActive = document.querySelector(
      `[data-bs-theme-value="${theme}"]`
    );
    const svgOfActiveBtn = btnToActive.querySelector("i").getAttribute("class");

    for (const element of document.querySelectorAll("[data-bs-theme-value]")) {
      element.classList.remove("active");
      element.setAttribute("aria-pressed", "false");
    }

    btnToActive.classList.add("active");
    btnToActive.setAttribute("aria-pressed", "true");
    activeThemeIcon.setAttribute("class", svgOfActiveBtn);
    const themeSwitcherLabel = `${themeSwitcherText.textContent} (${btnToActive.dataset.bsThemeValue})`;
    themeSwitcher.setAttribute("aria-label", themeSwitcherLabel);

    if (focus) {
      themeSwitcher.focus();
    }
  };

  window
    .matchMedia("(prefers-color-scheme: dark)")
    .addEventListener("change", () => {
      if (storedTheme !== "light" || storedTheme !== "dark") {
        setTheme(getPreferredTheme());
      }
    });

  window.addEventListener("DOMContentLoaded", () => {
    showActiveTheme(getPreferredTheme());

    for (const toggle of document.querySelectorAll("[data-bs-theme-value]")) {
      toggle.addEventListener("click", () => {
        const theme = toggle.getAttribute("data-bs-theme-value");
        localStorage.setItem("theme", theme);
        setTheme(theme);
        showActiveTheme(theme, true);
      });
    }
  });
})();
</script>



<script>
  document.addEventListener("DOMContentLoaded", function() {
    // Attach click events to pagination links initially
    attachPaginationClickEvents();

    // Attach click event to the Next button
    document.querySelector(".ajax-pagination-next").addEventListener("click", function(event) {
        event.preventDefault();

        // Find the currently active page button
        const activePageButton = document.querySelector(".pagination .page-item.active");

        if (activePageButton) {
            // Get the current page from the active page button
            const currentPage = parseInt(activePageButton.getAttribute("data-page"));
            const nextPage = currentPage + 1;

            // Construct the URL for the next page
            const url = `?page=${nextPage}`;

            // Load the next page using AJAX
            loadPage(url);
        }
    });
});
  
  // Function to load a page via AJAX
  function loadPage(url) {
      fetch(url, {
          headers: {
              "X-Requested-With": "XMLHttpRequest"
          }
      })
      .then(response => {
          if (!response.ok) throw new Error("Network response was not ok");
          return response.json();
      })
      .then(data => {
          // Update the table content
          document.getElementById("movie-table-container").innerHTML = data.html;
  
          // Update pagination container content with new pagination state (HTML passed from server-side)
          document.querySelector(".pagination-container").innerHTML = data.pagination_html;
  
          // Re-attach pagination click events as the DOM has changed
          attachPaginationClickEvents();
      })
      .catch(error => console.error("AJAX pagination fetch error:", error));
  }
  
  // Function to attach click events to pagination links
  function attachPaginationClickEvents() {
      document.querySelectorAll(".ajax-pagination").forEach(function(link) {
          link.addEventListener("click", function(event) {
              event.preventDefault();
              const url = link.getAttribute("href");
              loadPage(url);
          });
      });
  }
  
  // Function to update pagination links after each AJAX load
  function updatePaginationLinks() {
      const activePageButton = document.querySelector(".pagination .page-item.active");
      if (activePageButton) {
          const currentPage = parseInt(activePageButton.getAttribute("data-page"));
          const nextPage = currentPage + 1;
  
          // Update the Next button to go to the incremented page number
          document.querySelector(".ajax-pagination-next").setAttribute("href", `?page=${nextPage}`);
          
          console.log(`Pagination links updated. Current page: ${currentPage}, Next page URL: ?page=${nextPage}`);
      } else {
          console.error("Error updating pagination links: Active page button not found.");
      }
  }
  </script>


</body><!--end::Body-->

</html>